"""–¢–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç –¥–ª—è –π–æ–≥–∞-–∫–ª—É–±–∞"""

import os
import logging
from telebot import TeleBot, types
from telebot.types import Update
from dotenv import load_dotenv
from flask import Flask, request

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    level=logging.INFO,  # –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
    format="%(asctime)s - %(name)s - %(levelname)s - %(message)s",
    handlers=[
        logging.FileHandler("bot.log"),  # –õ–æ–≥-—Ñ–∞–π–ª
        logging.StreamHandler(),  # –í—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å
    ],
)
logger = logging.getLogger(__name__)

# –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–∫–µ–Ω–∞ –∏–∑ .env
load_dotenv()
TELEGRAM_TOKEN = os.getenv("TELEGRAM_TOKEN")
WEBHOOK_URL = f"https://bot-yoga1369.onrender.com/webhook"

bot = TeleBot(TELEGRAM_TOKEN)

# –•–µ–Ω–¥–ª–µ—Ä –∫–æ–º–∞–Ω–¥—ã /start
@bot.message_handler(commands=["start"])
def start_message(message):
    chat_id = message.chat.id
    name = message.from_user.first_name

    logger.info(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {name} ({chat_id}) –∑–∞–ø—É—Å—Ç–∏–ª –∫–æ–º–∞–Ω–¥—É /start")

    try:
        # –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
        keyboard = types.ReplyKeyboardMarkup(resize_keyboard=True)
        keyboard.add(
            types.KeyboardButton("‚ú® –æ–±–æ –º–Ω–µ"),
            types.KeyboardButton("üßòüèº‚Äç‚ôÄÔ∏è –ø—Ä–æ–±–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞")
        )
        keyboard.add(types.KeyboardButton("üéü 13¬∑YOGA¬∑69 –ø–æ–¥–ø–∏—Å–∫–∞"))
        keyboard.add(
            types.KeyboardButton("üëØ‚Äç‚ôÄÔ∏è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è"),
            types.KeyboardButton("ü´Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∞"))

        # –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
        bot.send_message(
            chat_id,
            f"**–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é, {name}!**\n\n"
            "–ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å *2 –ø—Ä–∞–∫—Ç–∏–∫–∏* —Å–æ –º–Ω–æ–π,\n"
            "–ø–æ—Å–ª–µ —á–µ–≥–æ –æ—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ –∑–∞–∫—Ä—ã—Ç—ã–π —Ç–µ–ª–µ–≥—Ä–∞–º–º –∫–∞–Ω–∞–ª.\n\n"
            "`üéü 13¬∑YOGA¬∑69`",
            parse_mode="Markdown",
            reply_markup=keyboard
        )

        logger.info(f"–°–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {chat_id}")
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {chat_id}: {e}")


# Flask-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ Telegram
app = Flask(__name__)


@app.route('/webhook', methods=['POST'])
def webhook():
    try:
        json_data = request.get_json()
        if json_data:
            bot.process_new_updates([Update.de_json(json_data)])
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ Webhook: {e}")
    return 'OK', 200


# –•–µ–Ω–¥–ª–µ—Ä –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–æ–±–æ –º–Ω–µ"
@bot.message_handler(func=lambda message: message.text == "‚ú® –æ–±–æ –º–Ω–µ")
def about_us(message):
    chat_id = message.chat.id

    # –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–ª–∞–π–Ω-–∫–Ω–æ–ø–∫–∏, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–∑—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–ø–æ–∫—É–ø–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏"
    inline_keyboard = types.InlineKeyboardMarkup()
    button = types.InlineKeyboardButton("üéü 13¬∑YOGA¬∑69 –ø–æ–¥–ø–∏—Å–∫–∞", callback_data="buy_subscription")
    inline_keyboard.add(button)

    bot.send_message(
        chat_id,
        "**–ü—Ä–∏–≤–µ—Ç, —è –¢–∞–Ω—è**, —Ç—Ä–µ–Ω–µ—Ä –ø–æ –π–æ–≥–µ –≤ —Å—Ç–∏–ª–µ *fysm*.\n"
        "–§–∏–∑–∏—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤ –º–æ–µ–π –∂–∏–∑–Ω–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ –¥–æ 30 –ª–µ—Ç.\n\n"
        "–Ø –ø—Ä–∏—à–ª–∞ –≤ –π–æ–≥—É —Å –±–æ–ª—å–Ω—ã–º–∏ –Ω–æ–≥–∞–º–∏ –∏ —Å–ø–∏–Ω–æ–π, –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º–∏ –º–∏–≥—Ä–µ–Ω—è–º–∏.\n"
        "–ü–µ—Ä–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —è –æ—â—É—Ç–∏–ª–∞ —Å–ø—É—Å—Ç—è –º–µ—Å—è—Ü –∑–∞–Ω—è—Ç–∏–π.\n\n"
        "–í—Å–µ, —á—Ç–æ –≤—ã –º–æ–≥–ª–∏ –≤–∏–¥–µ—Ç—å –Ω–∞ —Ñ–æ—Ç–æ, —É –º–µ–Ω—è –ø–æ–ª—É—á–∏–ª–æ—Å—å\n"
        "–∑–∞ **2 –≥–æ–¥–∞ —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –∑–∞–Ω—è—Ç–∏–π**.\n\n"
        "**–Ø –ø—Ä–∞–∫—Ç–∏–∫—É—é –∏ –ø—Ä–µ–ø–æ–¥–∞—é –±–µ–∑–æ–ø–∞—Å–Ω—É—é –π–æ–≥—É –ø–æ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ fysm**.\n"
        "–ï—Å–ª–∏ –≤—ã —Ç–∞–∫–∂–µ —Ö–æ—Ç–∏—Ç–µ –∑–∞ –∫–æ—Ä–æ—Ç–∫–∏–π —Å—Ä–æ–∫ –∏–∑–±–∞–≤–∏—Ç—å—Å—è –æ—Ç:\n\n"
        "üîπ *–ë–æ–ª–µ–π –≤ —Å–ø–∏–Ω–µ, –Ω–æ–≥–∞—Ö*\n"
        "üîπ *–ì–æ–ª–æ–≤–Ω—ã—Ö –±–æ–ª–µ–π*\n"
        "üîπ *–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ*\n"
        "üîπ *–û–±—Ä–µ—Å—Ç–∏ —Å–∏–ª—É, –≥–∏–±–∫–æ—Å—Ç—å, –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å*\n\n"
        "–ë—É–¥—É —Ä–∞–¥–∞ –≤–∏–¥–µ—Ç—å –≤–∞—Å –≤ –º–æ—ë–º *–∑–∞–∫—Ä—ã—Ç–æ–º Telegram-–∫–∞–Ω–∞–ª–µ*! üì≤\n\n"
        "üí° *–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ* ‚¨áÔ∏è",
        parse_mode="Markdown",
        reply_markup=inline_keyboard
    )


# **–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–Ω–ª–∞–π–Ω-–∫–Ω–æ–ø–∫–∏**
@bot.callback_query_handler(func=lambda call: call.data == "buy_subscription")
def show_subscription(call):
    chat_id = call.message.chat.id
    send_subscription_info(chat_id)


# –•–µ–Ω–¥–ª–µ—Ä –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ø–æ–∫—É–ø–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏"
@bot.message_handler(func=lambda message: message.text == "üéü 13¬∑YOGA¬∑69 –ø–æ–¥–ø–∏—Å–∫–∞")
def reviews(message):
    chat_id = message.chat.id
    send_subscription_info(chat_id)


# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–¥–ø–∏—Å–∫–µ
def send_subscription_info(chat_id):
    bot.send_message(
        chat_id,
        "–ù–∞ –∫–∞–Ω–∞–ª–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥—É—Ç –≤–∞–º –∑–∞ –∫–æ—Ä–æ—Ç–∫–æ–µ –≤—Ä–µ–º—è:\n"
        "‚úî *–ü—Ä–∏–æ–±—Ä–µ—Å—Ç–∏ –º—ã—à–µ—á–Ω—ã–π –∫–æ—Ä—Å–µ—Ç*\n"
        "‚úî *–ò–∑–±–∞–≤–∏—Ç—å—Å—è –æ—Ç –±–æ–ª–µ–π –≤ —Ç–µ–ª–µ*\n"
        "‚úî *–°–¥–µ–ª–∞—Ç—å —Ç–µ–ª–æ —Å–∏–ª—å–Ω—ã–º, –≥–∏–±–∫–∏–º –∏ –≤—ã–Ω–æ—Å–ª–∏–≤—ã–º*\n\n"
        "**üìÖ –ü—Ä–∞–∫—Ç–∏–∫–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç 2 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é:**\n"
        "üìå *–°—Ä–µ–¥–∞* ‚Äì –≤—ã—Ö–æ–¥–∏—Ç –∑–∞–ø–∏—Å—å –ø—Ä–∞–∫—Ç–∏–∫–∏\n"
        "üìå *–ü—è—Ç–Ω–∏—Ü–∞ 10:00 (Zoom)* ‚Äì –ø–æ–¥–∫–ª—é—á–∞–π—Å—è –∏ –ø–æ–ª—É—á–∞–π –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫—É –ø–æ–ª–æ–∂–µ–Ω–∏–π\n"
        "üìå –ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –æ–Ω–ª–∞–π–Ω ‚Äì **–≤—Å–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –æ—Å—Ç–∞—é—Ç—Å—è –≤ –∑–∞–ø–∏—Å–∏**\n\n"
        "**‚úÖ –ü—Ä–∞–∫—Ç–∏–∫–∏ –ø–æ–¥—Ö–æ–¥—è—Ç –≤—Å–µ–º, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –æ–ø—ã—Ç–∞ –≤ –π–æ–≥–µ**\n\n"
        "**‚õî –ü—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–∏—è:**\n"
        "üî∏ *–ë–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å*\n"
        "üî∏ *–ó–ª–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –Ω–æ–≤–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è*\n"
        "üî∏ *–ë–æ–ª–µ–∑–Ω–∏ –≤ –æ—Å—Ç—Ä–æ–π —Ñ–∞–∑–µ*\n\n"
        "**üí° –ß—Ç–æ –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å:**\n"
        "‚úî *–£–±—Ä–∞—Ç—å –±–æ–ª–∏ –≤ —Å–ø–∏–Ω–µ/—Ç–µ–ª–µ*\n"
        "‚úî *–£–ª—É—á—à–∏—Ç—å –º–æ–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å*\n"
        "‚úî *–ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—Å–∞–Ω–∫—É*\n"
        "‚úî *–°—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Å–∏—Ö–æ-—ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ*\n"
        "‚úî *–£–±—Ä–∞—Ç—å –∑–∞–∂–∏–º—ã –≤ —Ç–µ–ª–µ*\n"
        "‚úî *–ù–∞—É—á–∏—Ç—å—Å—è —Ä–æ–≤–Ω–æ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥—ã—à–∞—Ç—å*\n"
        "‚úî *–ù–∞–ª–∞–¥–∏—Ç—å —Ä–µ–∂–∏–º –¥–Ω—è, —Å–æ–Ω*\n"
        "‚úî *–û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–∏ –Ω–µ–æ—Å–æ–∑–Ω–∞–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –ø–æ–≤–µ–¥–µ–Ω–∏—è*\n\n"
        "üìå **[–°–°–´–õ–ö–ê –ù–ê –û–ü–õ–ê–¢–£](https://example.com/payment)**",
        parse_mode="Markdown"
    )


# –•–µ–Ω–¥–ª–µ—Ä –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ø—Ä–æ–±–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞"
@bot.message_handler(func=lambda message: message.text == "üßòüèº‚Äç‚ôÄÔ∏è –ø—Ä–æ–±–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞")
def marathon(message):
    chat_id = message.chat.id
    bot.send_message(
        chat_id,
        "https://t.me/yoga13_69",
    )


# –•–µ–Ω–¥–ª–µ—Ä –¥–ª—è –∫–Ω–æ–ø–∫–∏ "üëØ‚Äç‚ôÄÔ∏è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è"
@bot.message_handler(func=lambda message: message.text == "üëØ‚Äç‚ôÄÔ∏è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è")
def faq(message):
    chat_id = message.chat.id
    bot.send_message(
        chat_id,
        "üèî *–ô–û–ì–ê –¢–£–† –ö–†–ê–°–ù–ê–Ø –ü–û–õ–Ø–ù–ê* üèî\n\n"
        "üìÖ *16-18 –º–∞—Ä—Ç–∞, 3 –¥–Ω—è 2 –Ω–æ—á–∏*\n"
        "(–∑–∞–µ–∑–¥ 15:00, –≤—ã–µ–∑–¥ 12:00)\n"
        "üìç *–ö—Ä–∞—Å–Ω–∞—è –ü–æ–ª—è–Ω–∞*\n\n"
        "*–ß—Ç–æ –≤–∞—Å –∂–¥—ë—Ç:*\n"
        "- –ø—Ä–æ–∂–∏–≤–∞–Ω–∏–µ –≤ 2—Ö –º–µ—Å—Ç–Ω—ã—Ö –Ω–æ–º–µ—Ä–∞—Ö –≤ —É—é—Ç–Ω–æ–º –¥–æ–º–µ —Å –≤–∏–¥–æ–º –Ω–∞ –≥–æ—Ä—ã\n"
        "- –≤–∫—É—Å–Ω–æ–µ –∏ –ø–æ–ª–µ–∑–Ω–æ–µ –≤–µ–≥–µ—Ç–∞—Ä–∏–∞–Ω—Å–∫–æ–µ –ø–∏—Ç–∞–Ω–∏–µ\n"
        "- 5 –ø—Ä–∞–∫—Ç–∏–∫ –π–æ–≥–∏ –¥–ª—è –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏\n"
        "- –æ–±—â–µ–Ω–∏–µ, –ø—Ä–æ–≥—É–ª–∫–∏ –≤ –æ—Ç–ª–∏—á–Ω–æ–π –∫–æ–º–ø–∞–Ω–∏–∏, —Å–≤–µ–∂–∏–π –≥–æ—Ä–Ω—ã–π –≤–æ–∑–¥—É—Ö\n\n"
        "*–ß—Ç–æ –Ω–µ –≤—Ö–æ–¥–∏—Ç –≤ —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ç—É—Ä–∞:*\n"
        "- –±–∏–ª–µ—Ç—ã –Ω–∞ –¥–æ—Ä–æ–≥—É\n"
        "- –±–∞–Ω—è\n\n"
        "*–£—Å–ª–æ–≤–∏—è —É—á–∞—Å—Ç–∏—è:*\n"
        "- *23'000‚ÇΩ* –ø—Ä–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ –¥–æ 1 –º–∞—Ä—Ç–∞\n"
        "- *25'000‚ÇΩ* –ø—Ä–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø–æ—Å–ª–µ 1 –º–∞—Ä—Ç–∞\n"
        "- –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ *10'000‚ÇΩ*\n\n"
        "–ú–µ—Å—Ç –≤—Å–µ–≥–æ *12*! –£—Å–ø–µ–π –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å üôåüèº\n\n"
        "üíå *–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –º–æ–∂–Ω–æ, –Ω–∞–ø–∏—Å–∞–≤ –º–Ω–µ:* @Tania1369",
        parse_mode="Markdown"
    )


# –•–µ–Ω–¥–ª–µ—Ä –¥–ª—è –∫–Ω–æ–ø–∫–∏ "ü´Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∞"
@bot.message_handler(func=lambda message: message.text == "ü´Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∞")
def youtube_video(message):
    chat_id = message.chat.id
    bot.send_message(
        chat_id,
        "–µ—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã/–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, –Ω–∞–ø–∏—à–∏—Ç–µ @Tania1369",
    )


if __name__ == "__main__":
    logger.info("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ –≥–æ—Ç–æ–≤ –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è")
    # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Webhook
    bot.remove_webhook()
    bot.set_webhook(url=WEBHOOK_URL)
    logger.info("Webhook —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.")
    
    # –ó–∞–ø—É—Å–∫ Flask
    app.run(host="0.0.0.0", port=int(os.environ.get("PORT", 5000)))
